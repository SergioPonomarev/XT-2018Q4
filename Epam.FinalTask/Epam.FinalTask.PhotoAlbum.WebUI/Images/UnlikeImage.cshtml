@using Epam.FinalTask.PhotoAlbum.Common
@using Epam.FinalTask.PhotoAlbum.Entities

@{
    if (!IsPost)
    {
        Response.SetStatus(HttpStatusCode.NotFound);
        return;
    }

    string imageIdStr = Request["imageId"];
    string visitorIdStr = Request["visitorId"];
    int imageId = int.Parse(imageIdStr);
    int visitorId = int.Parse(visitorIdStr);
    Image image = null;

    try
    {
        image = DependencyResolver.ImagesLogic.GetImageById(imageId);
    }
    catch (Exception)
    {
        Response.SetStatus(HttpStatusCode.BadRequest);
        return;
    }

    if (image != null)
    {
        if (!DependencyResolver.ImagesLogic.RemoveLikeFromImage(image, visitorId))
        {
            Response.SetStatus(HttpStatusCode.BadRequest);
        }
    }
    else
    {
        Response.SetStatus(HttpStatusCode.NotFound);
    }
}