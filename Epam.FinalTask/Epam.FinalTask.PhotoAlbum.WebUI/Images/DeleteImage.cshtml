@using Epam.FinalTask.PhotoAlbum.Common
@using Epam.FinalTask.PhotoAlbum.Entities

@{
    if (!IsPost)
    {
        Response.SetStatus(HttpStatusCode.NotFound);
        return;
    }

    string imageIdStr = Request["imageId"];
    int imageId = int.Parse(imageIdStr);

    Image image = DependencyResolver.ImagesLogic.GetImageById(imageId);
    User owner = DependencyResolver.UsersLogic.GetUserByUserName(User.Identity.Name);

    if (owner.UserId != image.ImageOwnerId)
    {
        Response.SetStatus(HttpStatusCode.NotFound);
        return;
    }

    if (image != null)
    {
        DependencyResolver.ImagesLogic.Remove(image);
        Response.Redirect("/Index");
    }
    else
    {
        Response.SetStatus(HttpStatusCode.BadRequest);
    }
}