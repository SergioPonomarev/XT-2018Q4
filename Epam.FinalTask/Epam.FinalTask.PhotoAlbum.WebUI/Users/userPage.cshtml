@using dr = Epam.FinalTask.PhotoAlbum.Common.DependencyResolver
@using Avatar = Epam.FinalTask.PhotoAlbum.Entities.Avatar
@using User = Epam.FinalTask.PhotoAlbum.Entities.User
@using Image = Epam.FinalTask.PhotoAlbum.Entities.Image

@{
    if (!User.IsInRole("Users"))
    {
        Response.Redirect("~/Account/Registration");
        return;
    }

    string userName = Request["name"];
    Page.Title = userName;

    User user = dr.UsersLogic.GetUserByUserName(userName);
    Avatar avatar = dr.AvatarsLogic.GetUserAvatarByUserName(userName);
}

@section styles {
    <link href="~/Content/Custom/userPage.css" rel="stylesheet" />
}

@section scripts {
    <script src="~/Scripts/Custom/userPage.js"></script>
}

    <div class="wrap">
        <div class="userDataBlock">
            @if (user.Banned)
            {
                <p class="banMessage">This user is banned!</p>
            }

            <h2 class="userAcc_header">@userName</h2>
            <img class="userAcc_avatar" src="data:@avatar.MimeType;base64,@avatar.AvatarData" alt="User Avatar" />

            @if ((User.IsInRole("Admins") && user.UserRole == "User") || User.IsInRole("SuperAdmins"))
            {
                if (!user.Banned)
                {
                    <button class="btnUser btnUserBan" title="Ban this user">
                        <i class="fa fa-ban"></i>
                    </button>
                }
                else
                {
                    <button class="btnUser btnUserUnban" title="Unban this user">
                        <i class="fa fa-check-circle-o"></i>
                    </button>
                }
            }

            @if (User.Identity.Name == user.UserName)
            {
                <a href="/Users/EditProfile?userName=@user.UserName" class="btnProfile btnProfile_edit">Edit profile</a>
                <button data-name="@user.UserName" id="deleteBtn" class="btnProfile btnProfile_delete">Delete profile</button>
            }
        </div>

        <div class="imagesBlock">
            @foreach (Image image in user.UserImages)
            {
                <div class="imageWrapper">
                    <a href="/Images/ImagePage?imageId=@image.ImageId" class="imagePageLink">
                        @if (!image.Banned)
                        {
                            <img class="image" src="data:@image.MimeType;base64,@image.ImageData" alt="User image id: @image.ImageId" />
                        }
                        else
                        {
                            Image bannedImage = dr.ImagesLogic.GetBannedImage();
                            <img class="image" src="data:@bannedImage.MimeType;base64,@image.ImageData" alt="This image is banned" />
                        }
                    </a>
                </div>
            }
        </div>
    </div>
